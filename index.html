<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weighted Grade Planner</title>
<style>
  :root{
    --bg:#0b0b10;--panel:#111219;--panel2:#0f1016;--text:#e8ebf2;--muted:#a8afbd;--line:#242739;
    --brand:#6d7cff;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:500 15px/1.55 system-ui,Segoe UI,Inter,Arial,sans-serif}
  .container{max-width:1100px;margin:40px auto;padding:0 16px}
  h1{margin:0 0 6px;font-weight:800}
  p.muted{margin:.25rem 0 1rem;color:var(--muted)}
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:14px;padding:16px;margin:14px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  label{font-weight:600}
  input,button{border-radius:10px;border:1px solid #2a2f46;background:#121423;color:var(--text);padding:10px 12px}
  input[type="number"]{text-align:right}
  .btn{cursor:pointer}
  .btn:hover{border-color:#3b4161;transform:translateY(-1px)}
  .primary{background:linear-gradient(135deg,var(--brand),#9b6dff);border-color:transparent}
  .danger{border-color:#5b1f26;background:#251015}
  table{width:100%;border-collapse:collapse;border-spacing:0}
  th,td{border-top:1px solid var(--line);padding:10px 8px;text-align:left}
  th{font-weight:700;color:#cfd3e6;background:#121425;position:sticky;top:0;z-index:1}
  tbody tr:first-child td{border-top:1px solid var(--line)}
  .right{text-align:right}
  .mutedSmall{color:var(--muted);font-size:12px}
  .badge{display:inline-block;padding:4px 8px;border:1px solid #353a56;border-radius:999px;background:#121423;color:#cfd3ff;font-size:12px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  .del-btn {
    background:none;
    border:none;
    cursor:pointer;
    font-size:18px;
    color:#f87171;
    padding:4px 8px;
    transition:transform 0.2s, color 0.2s;
  }
  .del-btn:hover {
    transform:scale(1.2);
    color:#ef4444;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Weighted Grade Planner</h1>
  <p class="muted">Enter category <b>weights</b>, your current <b>earned/possible</b>, and the <b>planned total</b> points for each category.
    Set a target final grade to see the <b>required average on remaining work</b>. Add/remove rows as needed.</p>

  <!-- Controls -->
  <div class="panel">
    <div class="row">
      <button class="btn" id="addRow">+ Add Category</button>
      <button class="btn" id="resetMarks">Reset marks & weights</button>
      <button class="btn danger" id="clearAll">Clear ALL</button>
      <button class="btn" id="exportBtn">Export JSON</button>
      <label class="btn" for="importFile" style="cursor:pointer">Import JSON</label>
      <input id="importFile" type="file" accept="application/json" style="display:none">
    </div>
    <div class="row" style="margin-top:10px">
      <label for="target">Target final grade:</label>
      <input id="target" type="number" min="0" max="100" step="0.1" value="90" style="width:120px"> %
      <label for="futureAssume" style="margin-left:18px">Assumed future % (default):</label>
      <input id="futureAssume" type="number" min="0" max="100" step="0.1" value="85" style="width:120px"> %
      <div class="mutedSmall">You can override per-category later.</div>
    </div>
  </div>

  <!-- Table -->
  <div class="panel" style="overflow:auto;max-height:70vh">
    <table id="gradeTable" aria-label="grade table">
      <thead>
        <tr>
          <th>Category</th>
          <th class="right">Weight</th>
          <th class="right">Earned</th>
          <th class="right">Possible (to date)</th>
          <th class="right">Planned Total</th>
          <th class="right">% so far</th>
          <th class="right">Future % (optional)</th>
          <th class="right">Projected Category %</th>
          <th class="right">Weighted Contribution</th>
          <th class="right">üóë</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
      <tfoot>
        <tr>
          <td class="right" colspan="1">Totals:</td>
          <td class="right" id="weightSum">0%</td>
          <td class="right" id="earnedSum">0</td>
          <td class="right" id="possibleSum">0</td>
          <td class="right" id="plannedSum">0</td>
          <td class="right" id="avgSoFar">‚Äî</td>
          <td class="right">‚Äî</td>
          <td class="right" id="projAvg">‚Äî</td>
          <td class="right" id="weightedTotal">0%</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="panel">
    <b>Notes / Requirements</b>
    <ul class="mutedSmall">
      <li>Enter weights as <i>20</i> or <i>20%</i>. Weights should total 100% for accurate projections.</li>
      <li><b>Planned Total</b> = total points expected in the category by term end. Leave blank if no more items remain.</li>
      <li>Use ‚ÄúFuture %‚Äù to guess future performance; or use the slider to see ‚Äúwhat if‚Äù results.</li>
    </ul>
  </div>
</div>

<script>
  const $ = (s, d=document)=>d.querySelector(s);
  const $$ = (s, d=document)=>Array.from(d.querySelectorAll(s));
  const pct = v => isFinite(v) ? (v*100).toFixed(2)+'%' : '‚Äî';
  const toNum = v => { const s=String(v??'').trim(); if(!s) return NaN; return parseFloat(s); };
  const parseWeight = raw => { const s=String(raw??'').trim(); if(!s) return 0; return s.endsWith('%')? parseFloat(s)/100 : parseFloat(s)/100; };

  function rowTemplate(d={}) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input placeholder="Assignments / Exams / Project" value="${d.name||''}"></td>
      <td class="right"><input inputmode="decimal" placeholder="20 or 20%" value="${d.weight||''}"></td>
      <td class="right"><input inputmode="decimal" placeholder="earned" value="${d.earned||''}"></td>
      <td class="right"><input inputmode="decimal" placeholder="possible" value="${d.possible||''}"></td>
      <td class="right"><input inputmode="decimal" placeholder="planned total" value="${d.planned||''}"></td>
      <td class="right"><span class="sofar">‚Äî</span></td>
      <td class="right"><input inputmode="decimal" placeholder="future %" value="${d.future||''}"></td>
      <td class="right"><span class="projCat">‚Äî</span></td>
      <td class="right"><span class="weighted">‚Äî</span></td>
      <td class="right"><button class="del-btn" title="Delete Row">üóë</button></td>`;
    tr.querySelectorAll("input").forEach(i=>i.addEventListener("input",recalc));
    tr.querySelector(".del-btn").addEventListener("click",()=>{tr.remove();recalc();});
    return tr;
  }

  function getRowsData(){
    return $$('#rows tr').map(tr=>{
      const [name, wt, e, p, plan, , fut] = tr.querySelectorAll('input');
      return {
        name: name.value, weight: parseWeight(wt.value),
        earned: toNum(e.value), possible: toNum(p.value),
        planned: toNum(plan.value), future: toNum(fut.value)
      };
    });
  }

  function setRowsData(arr){
    $('#rows').innerHTML='';
    arr.forEach(d=>$('#rows').appendChild(rowTemplate(d)));
    recalc();
  }

  function calcProjection(rows, defaultFuturePct){
    let weightSum=0, projectedWeighted=0;
    rows.forEach((r,idx)=>{
      const w=isFinite(r.weight)?r.weight:0;
      const e=isFinite(r.earned)?r.earned:0;
      const p=isFinite(r.possible)?r.possible:0;
      const t=isFinite(r.planned)?(r.planned>0?r.planned:NaN):NaN;
      const plan=isFinite(t)?t:(isFinite(p)?p:0);
      const remain=Math.max(plan-(isFinite(p)?p:0),0);
      const sofar=(p>0)?(e/p):NaN;
      const fut=isFinite(r.future)?(r.future/100):(isFinite(defaultFuturePct)?defaultFuturePct/100:0);
      const proj=(plan>0)?((e+fut*remain)/plan):(isFinite(sofar)?sofar:0);
      const weighted=w*proj;
      weightSum+=w; projectedWeighted+=weighted;
      const tr=$$('#rows tr')[idx];
      tr.querySelector('.sofar').textContent=isFinite(sofar)?pct(sofar):'‚Äî';
      tr.querySelector('.projCat').textContent=pct(proj);
      tr.querySelector('.weighted').textContent=pct(weighted);
    });
    return {weightSum,projectedWeighted};
  }

  function recalc(){
    const rows=getRowsData();
    const defFuture=toNum($('#futureAssume').value);
    const s=calcProjection(rows,defFuture);
    $('#weightSum').textContent=(s.weightSum*100).toFixed(2)+'%';
    $('#weightedTotal').textContent=pct(s.projectedWeighted);
    $('#overall').textContent=pct(s.projectedWeighted);
  }

  function resetMarksAndWeights(){
    $$('#rows tr').forEach(tr=>{
      const inputs=tr.querySelectorAll('input');
      const [nameI,wtI,eI,pI,planI,futI]=inputs;
      if(wtI)wtI.value='';
      if(eI)eI.value='';
      if(pI)pI.value='';
      if(planI)planI.value='';
      if(futI)futI.value='';
    });
    recalc();
  }

  $('#addRow').addEventListener('click',()=>{$('#rows').appendChild(rowTemplate());recalc();});
  $('#resetMarks').addEventListener('click',resetMarksAndWeights);
  $('#clearAll').addEventListener('click',()=>{if(confirm('Clear all rows?')){$('#rows').innerHTML='';recalc();}});
  $('#exportBtn').addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify(getRowsData(),null,2)],{type:'application/json'});
    const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='grade_setup.json';a.click();
  });
  $('#importFile').addEventListener('change',e=>{
    const f=e.target.files[0];if(!f)return;
    const reader=new FileReader();
    reader.onload=()=>{try{setRowsData(JSON.parse(reader.result));}catch{alert('Invalid JSON');}};
    reader.readAsText(f);
  });

  (function init(){
    setRowsData([
      {name:'Assignments',weight:'20',earned:'',possible:'',planned:'',future:''},
      {name:'Project',weight:'30',earned:'',possible:'',planned:'',future:''},
      {name:'Quizzes/Exams',weight:'40',earned:'',possible:'',planned:'',future:''},
      {name:'Participation',weight:'10',earned:'',possible:'',planned:'',future:''},
    ]);
  })();
</script>
<div style="position:fixed;right:12px;bottom:12px;font:12px system-ui;opacity:.5">Build: 7</div>
</body>
</html>
